[[qvd-vma-config]]
Adding and Configuring the VMA
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In order for QVD to be able to serve the Operating System Image to
connecting clients, the image will need to have the QVD VMA (Virtual
Machine Agent) installed. This is provided as a package from the QVD
repositories.

To install the vma package, you should open a terminal or console
window within your new Ubuntu installation running in the virtual
machine, and run the following commands:

----
# sudo apt-add-repository ppa:qvd-qindel/qvd-3.1
# sudo apt-get update
# sudo apt-get install qvd-vma
----

This will add the QVD package repository to your apt resources, update
the package cache and then install the QVD VMA and all of its
dependencies.

VMA Configuration
^^^^^^^^^^^^^^^^^
Once the vma is installed, it will need to be properly configured.
Configuration settings for the VMA are stored in the file at
`/etc/qvd/vma.conf`. The configuration file is read by the VMA when it
is started, so any changes to the configuration file will require that
the VMA is restarted in order for the changes to come into effect.

The VMA can be restarted by running the command:

----
# sudo /etc/init.d/qvd-vma restart
----
There are some basic configuration parameters that can be configured
within the VMA to facilitate how a client will interact with the
virtual machine.

Audio
+++++
....
vma.audio.enable
....

Possible values:  

0 => Audio is not enabled in the virtual machine (Default)
1 => Audio is enabled in the virtual machine

NOTE: In order to get Audio working within QVD, you will need to
ensure that your DI is configured correctly. Usually it is easiest if
you make use of PulseAudio (default in Ubuntu) and that it is
configured to enable network access to local sound devices. You can
configure this using the program `paprefs`.

Printing
++++++++o
....
vma.printing.enable
....

Possible Values:

0=> Printers are not enabled (Default)
1=> Printers are enabled

The QVD client and the VMA will map all the printers configured on the
client. Currently, you will need to ensure that the required printer
drivers are installed on the DI.

PID location
++++++++++++
....
vma.pid_file 
....

The place where the pid resides, by default /var/run/qvd/vma.pid


Keyboard
++++++++

....
vma.default.client.keyboard
....

The default keyboard in the virtual machine, this value is used if no
other values are detected by the client. The default value is
'pc105/en'. To modify this the value must be in format
layout/distribution


Default link
++++++++++++
The default NX connection link is set by this paramenter unless the client
overrides this value. Usually, the QVD client will set its own value.

....
vma.default.client.link 
....

Possible values for this key are: 

local
adsl  (Default)
modem

VMA Hooks
+++++++++
The VMA can also have a variety of additional configuration entries
that control actions within the running operating system for the
virtual machine, based on particular activities relating to QVD. These
are known as VMA Hooks. We discuss these settings in significantly
more detail in the chapter titled <<qvd-vma-hooks,VMA Hooks>>.

[[qvd-serial-port-access]]
Setting up Serial Port access
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In order for an Administrator to connect to the running Virtual
Machine via a serial connection you will need to 
configure access within the DI that you have created.

To configure the serial port you will need to perform the following
steps as the root user in your running virtual machine:

----
# sudo editor /etc/init/ttyS0.conf
----

Add the configuration

----
# ttyS0 - getty
#
# This service maintains a getty on ttyS0 from the point the system is
# started until it is shut down again.

start on stopped rc RUNLEVEL=[2345]
stop on runlevel [!2345]

respawn
exec /sbin/getty -L 115200 ttyS0 xterm
----

Once the Serial Port has been configured, the default settings for any
Server Node will allow you to access a running Virtual Machine using
telnet or the QVD CLI Administration Utility with a command like:

----
# qvd-admin vm console -f id=1
----
