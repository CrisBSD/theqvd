Printing in QVD
---------------

This section explains how printers on the client machine are mapped to printers
on the virtual machine.

Technical overview
~~~~~~~~~~~~~~~~~~

If printing is enabled in the VMA (setting `vma.printing.enable` in `vma.conf`),
the VMA will run `qvd-printing` when the session starts. This program in turn
lists the printers from the client and configures them locally. The details
depend on the client operating system:

* On *Windows* we use SMB/CIFS to list printers shared on the client, and map
  those. Some effort is made to maintain the printer name so that users can
  recognize the mapped printer on the virtual machine.
* On *Linux* we use CUPS. Every printer on the client is mapped to a printer on
  the virtual machine.

Enabling printing on the client
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To enable printer redirection on the QVD client, add the following lines to
`client.conf`.

----
# Enable printing
client.printing.enable=1
----

For more details see the client configuration guide.

Additional setup needed for Windows clients
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

To use a local printer on a QVD virtual machine first *share* the printer with
the local network.

NOTE: On Windows 7 you have to *turn off password protected sharing* in
"Advanced sharing settings. This is because we use the anonymous user to list
the printers.

image::../images/advanced_sharing_settings.png[alt="Screenshot of advanced sharing settings, showing to to turn off password protected sharing"]

Troubleshooting
~~~~~~~~~~~~~~~

To troubleshoot printing problems with Windows clients you can use the
`smbclient` tool. Use the following command to list resources shared by the
client machine.

----
smbclient -L 127.0.0.1 -p 2100 -gN
----

* *Called name not present* - Reinstall the QVD client and restart Windows. The
  SMB/CIFS server in Windows 7 doesn't accept connections to 127.0.0.1 with the
  default configuration. The installer solves this issue by modifying the
  registry key `HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Parameters`
  and setting the value of `OptionalNames` to `127.0.0.1`. 

image::../images/regedit.png[alt="Screenshot of Windows registry editor", width=33%]

* *NT_STATUS_ACCESS_DENIED* - Anonymous login was blocked. Check that you have
  turned off "password protected sharing."  
